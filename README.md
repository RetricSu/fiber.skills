# Fiber Network Skill 评估与改进建议

## 现状评估

本 skill 仓库对 Fiber Network 的覆盖质量较高，主要包括：

- **SKILL.md**：架构概览、通道生命周期、支付特性、配置参考、常用模式
- **references/RPC_API.md**：完整的 JSON-RPC API 参考（参数、返回值、curl 示例）
- **references/ON_CHAIN_SCRIPTS.md**：Funding Lock 和 Commitment Lock 合约的数据结构与验证逻辑

这些内容足以理解 Fiber 原理和 API 接口，但从「端到端开发 Fiber 应用」的角度看，还有以下缺口。

---

## 缺失与改进项

### P0 - 关键缺失

#### 1. 事件/订阅机制文档

应用开发者最常见的需求是「收到付款时通知我」。当前仓库完全没有事件通知相关文档：

- 是否有 WebSocket 订阅 API？（技术栈用了 jsonrpsee，支持 WebSocket）
- 如何监听支付到达、通道状态变化等事件？
- 当前是否只能靠轮询 `get_payment` / `get_invoice`？

对于支付网关、POS 系统、自动化机器人等应用，这是最关键的缺失。

#### 2. 本地开发环境搭建指南

- 如何搭建本地 devnet 跑两个 Fiber 节点做测试？
- 有没有 Docker Compose 一键启动的方案？
- `scripts/` 目录当前为空，缺少开发辅助脚本（如启动节点、创建通道、发送测试支付等）

应用开发者如果不能本地测试，开发体验会很差。

---

### P1 - 重要改进

#### 3. TypeScript 类型定义与 SDK 封装

所有示例都是 raw curl JSON-RPC 调用，缺少：

- RPC 参数和返回值的 TypeScript 类型定义
- 封装 RPC 客户端的最佳实践
- 与前端框架（React/Next.js）集成的模式

#### 4. 流动性管理与容量规划

对生产应用至关重要但完全没提到：

- 入站（inbound）vs 出站（outbound）流动性概念
- 通道容量不足时的处理策略
- 何时开新通道 vs 通道再平衡
- `MIN_CHANNEL_CKB_AMOUNT`（162 CKB）和 `RESERVED_CKB_PER_PARTY`（98 CKB）对实际可用余额的影响

---

### P2 - 有价值的补充

#### 5. Invoice 编码格式规范

`fibt1000000001p...` 这种 Invoice 字符串到处在用，但从没解释过：

- 编码规范是什么？（类似 BOLT11？Bech32？）
- 包含哪些字段？
- 应用层能否自己解析而不调用 `parse_invoice`？

#### 6. 错误恢复与重试策略

当前的错误表太简略，应用开发者需要知道：

- 支付失败后如何安全重试（幂等性？用同一个 payment_hash 重试会怎样？）
- 通道在支付中途被关闭会发生什么？
- 网络分区恢复后的状态恢复

---

### P3 - 生产部署前需要

#### 7. 安全配置

提到了 Biscuit 认证但没有细节：

- 如何配置 RPC 认证？
- 生产环境的最小权限配置
- 私钥管理和备份方案

#### 8. 节点运维指南

- 从源码编译或用二进制部署 Fiber 节点的步骤
- 日志配置和故障排查
- 数据库（RocksDB）的备份和恢复
- 升级节点版本的流程

---

## 优先级总结

| 优先级 | 改进项 | 原因 |
|--------|--------|------|
| **P0** | 事件/订阅 API 文档 | 没有这个无法构建响应式应用 |
| **P0** | 本地开发环境搭建指南 + scripts/ 脚本 | 开发者上手的第一步 |
| **P1** | TypeScript 类型定义 + SDK 封装示例 | 降低应用开发门槛 |
| **P1** | 流动性管理和容量规划指导 | 生产部署必需 |
| **P2** | Invoice 格式规范 | 方便应用层解析 |
| **P2** | 错误恢复和重试策略 | 提高应用可靠性 |
| **P3** | 安全配置和运维指南 | 生产上线前必需 |
